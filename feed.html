<!DOCTYPE html>
<!-- تعريف نوع المستند كـ HTML5 -->
<html lang="en">
<!-- بدء عنصر HTML مع تحديد اللغة الإنجليزية (يمكنك تغييرها إلى "ar" إذا كان المحتوى عربيًا) -->

<head>



    <!-- رأس الصفحة: يحتوي على معلومات تعريفية وروابط خارجية -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css  ">

    <meta charset="UTF-8">
    <!-- تحديد ترميز النصوص كـ UTF-8 لدعم الحروف العربية والخاصة -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ضمان استجابة التصميم على جميع أحجام الشاشات -->
    <title>Feed - Ahlyia connect</title>
    <!-- عنوان علامة التبويب في المتصفح -->
    <link rel="stylesheet" href="css/feed.css">
    <!-- ربط ملف CSS خاص بتصميم صفحة الـ Feed -->
</head>

<body>
    <!-- بدء محتوى الصفحة المرئي -->

    <nav class="navbar">
        <!-- شريط التنقل العلوي -->
        <div class="container">
            <!-- حاوية لتوحيد العرض (عادة ما تكون بعرض ثابت أو مرن مع هوامش) -->

            <div class="logo">Ahlyia connect</div>
            <!-- شعار الموقع أو اسمه -->
            <div class="nav-links">
                <!-- مجموعة روابط التنقل -->
                <a href="index.html">Home</a>
                <!-- رابط الصفحة الرئيسية -->
                <a href="feed.html" class="active">Feed</a>
                <!-- رابط صفحة التغذية مع فئة "active" للتمييز -->
                <a href="create-post.html">Create Post</a>
                <!-- رابط إنشاء منشور -->
                <a href="my-posts.html">My Posts</a>
                <!-- رابط منشوراتي -->
                <a href="profile.html">Profile</a>
                <!-- رابط الملف الشخصي -->
            </div>
        </div>
    </nav>

    <main class="container">
        <!-- المحتوى الرئيسي للصفحة داخل حاوية -->
        <h1>Community Feed</h1>
        <!-- عنوان رئيسي للصفحة -->
        <p>See what's happening in Ahliya university community</p>
        <!-- وصف قصير لمحتوى الصفحة -->
        <div id="postsContainer" class="feed-container">
            <!-- حاوية فارغة سيتم ملؤها بالمنشورات ديناميكيًا عبر JavaScript -->



    


        </div>
    </main>

    <footer>
        <!-- تذييل الصفحة -->
        <div class="container">
            <!-- حاوية داخل التذييل -->
            <p>&copy; 2025 Ahlyia connect. All rights reserved.</p>
            <!-- نص حقوق الملكية -->
        </div>
    </footer>

    <!-- بدء كود JavaScript -->
  <script>
    // انتظار تحميل الصفحة بالكامل قبل تنفيذ أي كود
    document.addEventListener('DOMContentLoaded', function() {
        renderPosts(); // استدعاء دالة عرض المنشورات عند فتح الصفحة
    });

    // ==============================
    // دالة عرض المنشورات
    // ==============================
    function renderPosts() {
        // ربط عنصر الحاوية التي ستعرض فيها المنشورات
        const postsContainer = document.getElementById('postsContainer');

        // جلب المنشورات من LocalStorage أو إنشاء مصفوفة فارغة إذا لا توجد
        const savedPosts = JSON.parse(localStorage.getItem('all_posts')) || [];

        // التحقق إذا لم توجد منشورات
        if (savedPosts.length === 0) {
            postsContainer.innerHTML ='<p style="text-align:center; padding:20px; color: var(--gray);">No posts to show yet.</p>'
            return; // الخروج من الدالة
        }

        // تفريغ الحاوية قبل عرض المنشورات الجديدة
        postsContainer.innerHTML = ''; 

        // التكرار على كل منشور وعرضه
        savedPosts.forEach((post) => {
            // إنشاء عنصر div لكل منشور
            const postCard = document.createElement('div');
            postCard.className = 'post-card'; // إضافة الكلاس للتنسيق
            postCard.setAttribute('data-id', post.id); // إضافة معرف المنشور كـ attribute

            // ==============================
            // 1. التحقق من وجود صورة بالمنشور
            // ==============================
            let imageSection = '';
            if (post.image) {
                imageSection = `
                    <div class="post-image-container">
                        <img src="${post.image}" class="post-image" alt="Post content">
                    </div>
                `;
            }

            // ==============================
            // 2. بناء الهيكل الكامل للمنشور
            // ==============================
            postCard.innerHTML = `
                <div class="post-header">
                    <div class="user-info">
                        <div class="post-author-avatar">A</div>
                        <div>
                            <span class="author-name">Student User</span>
                            <small class="post-date">${post.date}</small>
                        </div>
                    </div>
                    <!-- زر حذف المنشور -->
                    <button onclick="deletePost(${post.id})" class="btn-delete" title="Delete Post">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>

                <!-- نص المنشور -->
                <div class="post-content">
                    <p>${post.text}</p>
                </div>
                
                <!-- عرض الصورة إذا وجدت -->
                ${imageSection}
                
                <!-- أزرار التفاعل -->
                <div class="post-footer">
                    <button class="btn-action">
                        <i class="far fa-thumbs-up"></i> Like
                    </button>
                    <button class="btn-action">
                        <i class="far fa-comment"></i> Comment
                    </button>
                </div>
            `;

            // إضافة المنشور إلى الحاوية
            postsContainer.appendChild(postCard);
        });
    }

    // ==============================
    // دالة حذف المنشور
    // ==============================
    function deletePost(postId) {
        // التأكد من رغبة المستخدم بالحذف
        if (confirm('Are you sure you want to delete this post?')) {

            // 1️⃣ حذف المنشور من الفيد العام
            let allPosts = JSON.parse(localStorage.getItem('all_posts')) || [];
            allPosts = allPosts.filter(post => post.id !== postId); // تصفية المنشورات
            localStorage.setItem('all_posts', JSON.stringify(allPosts)); // حفظ التحديثات

            // 2️⃣ حذف المنشور من المنشورات الشخصية للحفاظ على التزامن
            let personalPosts = JSON.parse(localStorage.getItem('personal_posts')) || [];
            personalPosts = personalPosts.filter(post => post.id !== postId);
            localStorage.setItem('personal_posts', JSON.stringify(personalPosts));

            // إعادة عرض المنشورات بعد الحذف
            renderPosts();
        }
    }
</script>
</body>
</html>
</body>
</html>